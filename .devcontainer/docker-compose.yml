services:
  identigraf-uploader:
    build:
      context: .docker/identigraf-uploader
      dockerfile: Dockerfile
    environment:
      - NODE_ENV=development
      - NO_UPDATE_NOTIFIER=true
      - NPM_CONFIG_FUND=0
      - SUPPRESS_SUPPORT=1
      - HTTPS=0
      - PORT=3000
      - ENABLE_TRACING=1
      - OTEL_EXPORTER_ZIPKIN_ENDPOINT=http://zipkin:9411/api/v2/spans
      - IDENTIGRAF_UPLOAD_FOLDER=/var/lib/identigraf-uploader/uploads
      - IDENTIGRAF_MAX_FILE_SIZE=5242880
      - HAVE_SWAGGER=true
      - npm_config_userconfig=/usr/src/service/.npmrc.local
    restart: always
    volumes:
      - "../:/usr/src/service"
      - uploads:/var/lib/identigraf-uploader/uploads
    working_dir: /usr/src/service

  zipkin:
    image: openzipkin/zipkin:latest@sha256:f1573c1b40da38a751a6aa5f8ae0d7b1d6d567e60aace990c4413a3292ba2ba1
    restart: always

  swagger:
    image: swaggerapi/swagger-ui:latest@sha256:45fdf66a0d437c6539172b25456e4d0c78c903aee8a1a11c54a6b43948dab0ce
    environment:
      - SWAGGER_JSON_URL=/specs/identigraf-uploader.yaml
      - BASE_URL=/swagger
      - DISPLAY_REQUEST_DURATION=true
      - DEFAULT_MODELS_EXPAND_DEPTH=100
      - DEFAULT_MODEL_EXPAND_DEPTH=100
      - DEEP_LINKING=true
      - VALIDATOR_URL=none

volumes:
  uploads:
